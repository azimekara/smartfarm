import{_ as e}from"./_tslib-6e8ca86b.js";import{D as t}from"./dx-ui-element-de378e9d.js";import{C as n}from"./css-classes-f3f8ed66.js";import{C as i}from"./custom-events-helper-18f7786a.js";import{t as s}from"./constants-4c28185b.js";import{E as l}from"./eventhelper-8570b930.js";import{e as o}from"./property-d3853089.js";class d extends CustomEvent{constructor(e){super(d.eventName,{detail:new c(e),bubbles:!0,composed:!0,cancelable:!0})}}d.eventName=s+".focusin";class a extends CustomEvent{constructor(e){super(a.eventName,{detail:new p(e),bubbles:!0,composed:!0,cancelable:!0})}}a.eventName=s+".focusout";class r extends CustomEvent{constructor(e){super(r.eventName,{detail:e,bubbles:!0,composed:!0,cancelable:!0})}}r.eventName=s+".keydown";class u extends CustomEvent{constructor(e){super(u.eventName,{detail:e,bubbles:!0,composed:!0,cancelable:!0})}}u.eventName=s+".beforeinput";class h extends CustomEvent{constructor(e){super(h.eventName,{detail:e,bubbles:!0,composed:!0,cancelable:!0})}}h.eventName=s+".compositionEnd";class c{constructor(e){this.NeedSelection=e}}class p{constructor(e){this.Text=e}}class m{constructor(e){this.Text=e}}class f extends m{constructor(e,t){super(e),this.Version=t}}class v extends CustomEvent{constructor(e,t){super(v.eventName,{detail:new f(e,t),bubbles:!0,composed:!0,cancelable:!0})}}v.eventName=s+".textinput";class y extends CustomEvent{constructor(e){super(y.eventName,{detail:new m(e),bubbles:!0,composed:!0,cancelable:!0})}}y.eventName=s+".textchange",i.register(v.eventName,(e=>e.detail)),i.register(y.eventName,(e=>e.detail)),i.register(d.eventName,(e=>e.detail)),i.register(a.eventName,(e=>e.detail)),i.register(r.eventName,(e=>{const t=e.detail;return{Key:t.key,Code:t.code,CtrlKey:t.ctrlKey,AltKey:t.altKey,ShiftKey:t.shiftKey,MetaKey:t.metaKey}})),i.register(u.eventName,(e=>{const t=e.detail;return{InputType:t.inputType,Text:t.data}})),i.register(h.eventName,(e=>({Text:e.detail.data})));class b{constructor(e){this.action=null,this.handle=null,this.timeout=0,this.timeout=e}get hasAction(){return!!this.handle}execute(e){this.cancel(),this.action=e,this.handle=setTimeout((()=>{var e;null===(e=this.action)||void 0===e||e.call(this),this.handle=null,this.action=null}),this.timeout)}forceExecute(){if(!this.hasAction)return;const e=this.action;this.cancel(),e&&e()}cancel(){this.hasAction&&this.handle&&(clearTimeout(this.handle),this.action=null,this.handle=null)}}var x,E;!function(e){e.inputText="field-text",e.inputTextVersion="field-text-version",e.bindValueMode="bind-value-mode",e.fieldInputDelay="field-input-delay"}(x||(x={})),function(e){e.OnLostFocus="OnLostFocus",e.OnInput="OnInput",e.OnDelayedInput="OnDelayedInput"}(E||(E={}));const T=500;class I{}I.TextEdit=n.Prefix+"-text-edit",I.ClearButton=n.Prefix+"-edit-btn-clear";class g extends t{constructor(){super(...arguments),this.fieldText="",this.fieldTextVersion=-1,this.fieldInputDelay=500,this.bindValueMode=E.OnLostFocus,this.boundSlotChangedHandler=this.onSlotChanged.bind(this),this.boundOnInputInputHandler=this.onTextInput.bind(this),this.boundOnInputChangeHandler=this.onTextChange.bind(this),this.boundOnInputKeyDownHandler=this.onInputKeyDown.bind(this),this.boundOnPointerDownHandler=this.onPointerDown.bind(this),this.inputDelayDeferredAction=new b(500),this._fieldTextHistory={},this._fieldInitialized=!1,this._fieldTextVersion=-1}get inputSelectionStart(){var e,t;return null!==(t=null===(e=this.fieldElement)||void 0===e?void 0:e.selectionStart)&&void 0!==t?t:0}get inputSelectionEnd(){var e,t;return null!==(t=null===(e=this.fieldElement)||void 0===e?void 0:e.selectionEnd)&&void 0!==t?t:0}get selectionLength(){return Math.abs(this.inputSelectionEnd-this.inputSelectionStart)}get enabled(){var e,t;return null!==(t=!(null===(e=this.fieldElement)||void 0===e?void 0:e.disabled))&&void 0!==t&&t}get allowInput(){return this.enabled&&!!this.fieldElement&&!this.fieldElement.readOnly}static isClearButtonElement(e){var t;return!!e&&(null===(t=e.classList)||void 0===t?void 0:t.contains(I.ClearButton))}get fieldElementValue(){var e,t;return null!==(t=null===(e=this.fieldElement)||void 0===e?void 0:e.value)&&void 0!==t?t:""}set fieldElementValue(e){this.fieldElement&&(this.fieldElement.value=e)}get rendered(){return!!this.fieldElement}get focused(){return document.activeElement===this.fieldElement}raiseFieldText(){let e;const t=this.fieldElementValue;this.shouldProcessFieldTextVersion?(e=++this._fieldTextVersion,this._fieldTextHistory[e]=t):e=this._fieldTextVersion,this.dispatchEvent(new v(t,e))}raiseFieldChange(){this.dispatchEvent(new y(this.fieldElementValue))}applyTextProperty(){this.shouldProcessFieldTextVersion?this.applyTextPropertyByVersion():(this.applyTextPropertyCore(),this._fieldTextVersion=this.fieldTextVersion)}applyTextPropertyByVersion(){const e=this.fieldTextVersion,t=this.fieldText;let n=this._fieldTextVersion;e>n&&(n=e),-1===n||t!==this.fieldElementValue&&this._fieldTextHistory[e]!==t?(this.applyTextPropertyCore(),this._fieldTextVersion=n+1):delete this._fieldTextHistory[e]}applyTextPropertyCore(){this.fieldElementValue=this.fieldText}onBindValueModeChanged(e){e===E.OnLostFocus?(this._fieldTextHistory={},this._fieldTextVersion++):this.bindValueMode===E.OnLostFocus&&(this._fieldTextHistory={},this._fieldTextVersion=-1)}onInputDelayChanged(){this.inputDelayDeferredAction=new b(this.fieldInputDelay)}get shouldProcessFieldTextVersion(){return this.bindValueMode===E.OnInput||this.bindValueMode===E.OnDelayedInput}get shouldForceInputOnEnter(){return!0}onTextInput(e){if(this.shouldRaiseFieldTextEvents)switch(this.bindValueMode){case E.OnInput:this.raiseFieldText();break;case E.OnDelayedInput:this.inputDelayDeferredAction.execute((()=>this.raiseFieldText()))}}onTextChange(e){this.shouldRaiseFieldTextEvents&&(this.bindValueMode===E.OnLostFocus?this.raiseFieldChange():this.bindValueMode===E.OnDelayedInput&&this.tryForceDelayedInput())}onFieldReady(e,t){e.addEventListener("input",this.boundOnInputInputHandler),e.addEventListener("change",this.boundOnInputChangeHandler),e.addEventListener("keydown",this.boundOnInputKeyDownHandler),this.addEventListener("pointerdown",this.boundOnPointerDownHandler),t&&this.applyTextProperty()}onPointerDown(e){var t;l.containsInComposedPath(e,g.isClearButtonElement)&&(e.preventDefault(),document.activeElement!==this.fieldElement&&(null===(t=this.fieldElement)||void 0===t||t.focus()))}onInputKeyDown(e){this.processKeyDown(e)}processKeyDown(e){return"Enter"===e.key&&this.shouldForceInputOnEnter&&this.tryForceDelayedInput(),!1}tryForceDelayedInput(){this.shouldRaiseFieldTextEvents&&this.bindValueMode===E.OnDelayedInput&&this.inputDelayDeferredAction.forceExecute()}onDispose(e){null==e||e.removeEventListener("input",this.boundOnInputInputHandler),null==e||e.removeEventListener("change",this.boundOnInputChangeHandler),null==e||e.removeEventListener("keydown",this.boundOnInputKeyDownHandler),this.removeEventListener("pointerdown",this.boundOnPointerDownHandler)}onSlotChanged(e){this.fieldElement=this.getFieldElement(),this.fieldElement&&(this.onFieldReady(this.fieldElement,!this._fieldInitialized),this._fieldInitialized=!0)}get shouldRaiseFieldTextEvents(){return!0}updated(e){this.rendered&&e.has("bindValueMode")&&this.onBindValueModeChanged(e.get("bindValueMode")),this.rendered&&(e.has("fieldText")||e.has("fieldTextVersion"))&&this.applyTextProperty(),e.has("fieldInputDelay")&&this.onInputDelayChanged(),super.updated(e)}createRenderRoot(){const e=super.createRenderRoot(),t=document.createElement("slot");return e.appendChild(t),t.addEventListener("slotchange",this.boundSlotChangedHandler),e}}e([o({type:String,attribute:x.inputText})],g.prototype,"fieldText",void 0),e([o({type:Number,attribute:x.inputTextVersion})],g.prototype,"fieldTextVersion",void 0),e([o({type:Number,attribute:x.fieldInputDelay})],g.prototype,"fieldInputDelay",void 0),e([o({type:E,attribute:x.bindValueMode})],g.prototype,"bindValueMode",void 0);export{E as B,h as C,x as D,p as F,r as I,I as T,u as a,g as b,d as c,a as d,b as e,T as f};
